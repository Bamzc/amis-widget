import{BasePlugin as e,registerEditorPlugin as t}from"amis-editor";export{BasePlugin,getSchemaTpl}from"amis-editor";import{utils as r,Renderer as o,FormItem as n,OptionsControl as s}from"amis-core";import i from"react";import"jquery";import a from"react-dom";import c from"vue";var p,m;function f(e){let t=!1;if(!e)return!1;const r=new e;return r.rendererName?r.name?r.description?!r.tags||Array.isArray(r.tags)&&0===r.tags.length?console.error("[amis-widget]自定义插件注册失败，自定义组件分类（tags）不能为空。"):r.panelTitle?(r.icon||Object.assign(e.prototype,{icon:"fa fa-file-code-o"}),function(e){if(!e)return;e.rendererName&&e.rendererName.indexOf("")<0&&(e.rendererName=`-${e.rendererName}`);e.previewSchema&&e.previewSchema.type&&e.previewSchema.type.indexOf("")<0&&(e.previewSchema.type=`-${e.previewSchema.type}`);e.scaffold&&Array.isArray(e.scaffold)?e.scaffold.map((e=>(e.type.indexOf("")<0&&(e.type=`-${e.type}`),e))):e.scaffold&&e.scaffold.type&&e.scaffold.type.indexOf("")<0&&(e.scaffold.type=`-${e.scaffold.type}`)}(e.prototype),t=!0):console.error("[amis-widget]自定义插件注册失败，自定义组件配置面板Title（panelTitle）不能为空。"):console.error("[amis-widget]自定义插件注册失败，自定义组件描述（description）不能为空。"):console.error("[amis-widget]自定义插件注册失败，自定义组件名称（name）不能为空。"):console.error("[amis-widget]自定义插件注册失败，关联渲染器（rendererName）不能为空。"),t}function d(t,r){if(t&&t.prototype instanceof e)return u(t,r?.name),t;class o extends e{constructor(e){super(e)}}return Object.assign(o.prototype,new t),r&&Object.assign(o.prototype,r),u(o,r?.name),o}function u(e,r){if(e&&f(e)){const o=r||(new e).name;Object.assign(e.prototype,{isNpmCustomWidget:!0,name:o}),t(e),window&&window.postMessage&&window.postMessage({type:"amis-widget-register-event",eventMsg:"[amis-widget]注册一个自定义amis-editor插件",editorPluginName:o},"*")}}function h(e){if(e&&("function"==typeof e||"object"==typeof e)){class t extends i.Component{dom;instance;constructor(t){super(t),this.domRef=this.domRef.bind(this),this.instance="function"==typeof e?new e:e}componentDidMount(){const{onMount:e}=this.instance;e&&e.apply(this.instance,[this.props])}componentDidUpdate(e){const{onUpdate:t}=this.instance;t&&t.apply(this.instance,[this.props,e])}componentWillUnmount(){const{onUnmout:e}=this.instance;e&&e.apply(this.instance,this.props)}domRef(e){this.instance.$root=this.dom=e,this._render()}_render(){if(!this.dom)return;let e=this.instance.template;"string"==typeof e?this.dom.innerHTML=e:"function"==typeof e&&(this.dom.innerHTML=e(this.props))}render(){return i.createElement("div",{ref:this.domRef})}}return t}}function l(e){if(e&&("function"==typeof e||"object"==typeof e)){class t extends i.Component{domRef;vm;constructor(e){super(e),this.domRef=i.createRef(),this.resolveAmisProps=this.resolveAmisProps.bind(this),this.renderChild=this.renderChild.bind(this)}componentDidMount(){const{amisData:t,amisFunc:o}=this.resolveAmisProps(),{data:n,...s}=e="function"==typeof e?new e:e;this.vm=new c({data:r.extendObject(t,"function"==typeof n?n():n),...s,props:s.props||{}}),Object.keys(o).forEach((e=>{this.vm.$props[e]=o[e],"render"===e&&(this.vm.$props.renderChild=(e,t,r)=>{this.renderChild(e,t,r)})})),this.domRef.current.appendChild(this.vm.$mount().$el)}renderChild(e,t,r){let o=null;if(this.props.render&&t&&r){const n=this.props.render(e,t);o=a.render(n,document.getElementById(r))}return o}componentDidUpdate(){Object.keys(this.props).forEach((e=>"function"!=typeof this.props[e]&&(this.vm[e]=this.props[e]))),this.vm.$forceUpdate()}componentWillUnmount(){this.vm.$destroy()}resolveAmisProps(){let e={},t={};return Object.keys(this.props).forEach((r=>{const o=this.props[r];"function"==typeof o?e[r]=o:t[r]=o})),{amisData:t,amisFunc:e}}render(){return i.createElement("div",{ref:this.domRef})}}return t}}function y(e,t){if(!e)return;const r={type:"",usage:p.renderer,weight:0,framework:m.react};var i;if(t&&(i=t,"String"===Object.prototype.toString.call(i).slice(8,-1))?Object.assign(r,{type:t}):Object.assign(r,t),r&&!r.type)console.error("[amis-widget]自定义组件注册失败，自定义组件类型（type）不能为空。");else{r.type=function(e){let t=e;return e?(e&&e.indexOf("")<0&&(t=`-${e}`),t):t}(r.type),r.framework=function(e){let t=m.react;if(!e)return t;let r=e.toLowerCase().trim();switch(r){case"jquery":case"jq":r=m.jquery;break;case"vue":case"vue2":case"vue 2":case"vue2.0":case"vue 2.0":r=m.vue2;break;case"vue3":case"vue 3":case"vue3.0":case"vue 3.0":r=m.vue3,console.error("amis=widget不支持vue3.0技术栈，请改用vue3-amis-widget支持。");break;default:r=m.react}return r}(r.framework),r.usage=function(e){let t=p.renderer;if(!e)return t;let r=e.toLowerCase().trim();switch(r){case"renderer":case"renderers":default:r=p.renderer;break;case"formitem":case"form-item":case"form item":r=p.formitem;break;case"options":case"option":case"formoption":case"form-option":case"form option":r=p.options}return r}(r.usage);const t={renderer:o,formitem:n,options:s},i={react:e=>e,vue2:l,vue3:l,jquery:h}[r.framework](e);t[r.usage]?(t[r.usage]({type:r.type,weight:r.weight})(i),console.info("注册了一个自定义amis组件:",{type:r.type,weight:r.weight,component:i,framework:r.framework,usage:r.usage})):console.error(`[amis-widget]自定义组件注册失败，不存在${r.usage}自定义组件类型。`)}}!function(e){e.renderer="renderer",e.formitem="formitem",e.options="options"}(p||(p={})),function(e){e.react="react",e.vue2="vue2",e.vue3="vue3",e.jquery="jquery"}(m||(m={}));export{d as registerAmisEditorPlugin,y as registerRendererByType};
